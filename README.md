# FastAPI-ObjStorage-Compressor

## オブジェクト圧縮API

OpenStack Swiftオブジェクトストレージ上に存在するオブジェクトを1つのZIPファイルにし、圧縮ファイル管理アカウントのオブジェクトストレージ上にそのファイルをアップロードし、一時的なURLを生成して返却するAPIです。

APIリクエスト時に指定した`delete_after_seconds`の値に応じて、アップロードした圧縮ファイルが自動的に削除されます。


### 処理の流れ

```mermaid
graph TD;
    A[コンテナの存在チェック] -->|存在しない| B[エラー: コンテナが存在しない]
    A --> C[ファイルサイズの合計確認]
    C -->|5GBを超える| D[エラー: ファイルサイズの合計が5GBを超える]
    C --> E[ファイルのダウンロードと圧縮]
    E --> F[圧縮ファイルのアップロード]
    F --> G[X-Delete-After ヘッダで自動削除設定]
    G --> H[tmp_url の生成]
    H --> I[正常なレスポンスを返却]
    E -->|エラー発生| J[HTTPException: ダウンロード/圧縮エラー]
    F -->|エラー発生| K[HTTPException: アップロードエラー]
    G -->|エラー発生| L[HTTPException: 自動削除設定エラー]
    H -->|エラー発生| M[HTTPException: tmp_url生成エラー]
```

### エラーハンドリング

- コンテナが存在しない場合、HTTP ステータスコード 400 でエラーメッセージを返します。
- ファイルサイズの合計が 5GB を超える場合、HTTP ステータスコード 400 でエラーメッセージを返します。
- ダウンロード、圧縮、アップロード、tmp_url生成でエラーが発生した場合、適切なHTTPExceptionを発生させ、処理を終了します。